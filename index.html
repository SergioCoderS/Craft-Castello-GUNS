<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Castello Guns</title>
<style>
body {
  margin:0; padding:0; font-family:Arial,sans-serif;
  background:url('background.png') no-repeat center center fixed;
  background-size:cover;
  color:#fff;
}
.header {
  text-align:center; font-size:48px; font-weight:bold; padding:20px 0;
  background: rgba(0,0,0,0.6); backdrop-filter: blur(6px);
  letter-spacing:2px; text-shadow: 2px 2px 8px #000,0 0 10px #ff0000; color:#ff4444;
  font-family:"Georgia", serif; user-select:none;
}
.container { display:flex; min-height:100vh; flex-direction:row; }
.menu { width:220px; background: rgba(0,0,0,0.7); padding:20px; box-sizing:border-box; display:flex; flex-direction:column; gap:6px; }
.menu div { padding:12px; background: rgba(255,255,255,0.05); cursor:pointer; border-radius:6px; transition:0.2s; }
.menu div:hover, .menu .active { background: rgba(255,255,255,0.2); }
.content { flex:1; padding:30px; background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); overflow-y:auto; }
.controls { display:flex; gap:16px; align-items:center; flex-wrap:wrap; margin-bottom:24px; }
.items { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:12px; margin-bottom:24px; }
.items .item { padding:10px; background: rgba(255,255,255,0.1); cursor:pointer; border-radius:6px; transition:0.2s; display:flex; align-items:center; gap:8px; justify-content:space-between; min-height:40px; }
.items .item:hover { background: rgba(255,255,255,0.2); }
.items .active-item { outline: 2px solid #ff4444; }
.block { margin-top:30px; background: rgba(0,0,0,0.35); padding:20px; border-radius:8px; border:1px solid rgba(255,255,255,0.15); white-space:pre-line; }

/* –ü—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä */
.progress-container { margin-top:8px; background:rgba(0,0,0,0.5); border-radius:6px; padding:8px; }
.progress-bar { width:100%; height:24px; background:rgba(100,100,100,0.3); border-radius:4px; overflow:hidden; border:1px solid rgba(100,100,100,0.5); }
.progress-fill { height:100%; background:linear-gradient(90deg, #ff4444, #ff8844); width:0%; transition:width 0.3s ease; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:bold; color:#fff; }
.progress-text { font-size:12px; color:#ffb366; margin-top:4px; text-align:center; }

/* –°—Ç–∞—Ç—É—Å —Ä–µ—Å—É—Ä—Å—ñ–≤ –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏ */
.resource-item.base-resource { border-left:3px solid #8b5e3c; }
.resource-item.ingot-resource { border-left:3px solid #aaaaaa; }
.resource-item.component-resource { border-left:3px solid #6677ff; }

.resource-status { width:24px; height:24px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:12px; flex-shrink:0; }
.status-empty { background:rgba(100,100,100,0.3); color:#888; }
.status-partial { background:rgba(255,200,0,0.3); color:#ffc800; }
.status-complete { background:rgba(100,200,100,0.3); color:#66ff66; }

/* –ü–æ—à—É–∫ */
.search-box { width:100%; padding:10px 14px; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.25); border-radius:6px; color:#fff; margin-bottom:24px; }
.search-box::placeholder { color:rgba(255,255,255,0.5); }

/* –í–∫–ª–∞–¥–∫–∏ */
.tabs-container { display:flex; gap:8px; margin-bottom:20px; flex-wrap:wrap; }
.tab-btn { padding:6px 12px; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); border-radius:4px; color:#fff; cursor:pointer; transition:0.2s; font-size:12px; }
.tab-btn:hover { background:rgba(255,255,255,0.15); }
.tab-btn.active { background:rgba(255,100,100,0.3); border-color:rgba(255,100,100,0.5); }

/* –£–ª—é–±–ª–µ–Ω—ñ */
.favorites-badge { position:relative; }
.favorites-badge.favorited::after { content:'‚òÖ'; position:absolute; top:-8px; right:-8px; color:#ffc800; font-size:20px; }

label { display:inline-flex; align-items:center; gap:8px; }
input, select { padding:6px 8px; border-radius:6px; border:1px solid rgba(255,255,255,0.25); background: rgba(0,0,0,0.3); color:#fff; }
input[type="number"] { width:90px; }
.section-title { font-weight:bold; color:#ffdddd; margin-bottom:6px; display:inline-block; }

/* –í—ñ–¥–º—ñ—Ç–∫–∏ –¥–ª—è —Ä–µ—Å—É—Ä—Å—ñ–≤ */
.resource-item { display:flex; align-items:center; gap:10px; padding:12px 16px; margin:10px 0; background:rgba(255,255,255,0.08); border-radius:6px; cursor:pointer; transition:0.2s; min-height:48px; }
.resource-item:hover { background:rgba(255,255,255,0.12); }
.resource-item.collected { background:rgba(100,200,100,0.2); }
.resource-item input[type="checkbox"] { cursor:pointer; width:18px; height:18px; flex-shrink:0; }
.resource-item label { margin:0; display:flex; align-items:center; gap:8px; flex:1; min-width:0; }
.resource-item .resource-count { min-width:60px; text-align:right; font-weight:bold; color:#ffb366; flex-shrink:0; }
.button-group { display:flex; gap:12px; margin-bottom:20px; flex-wrap:wrap; }
.btn { padding:8px 12px; background:rgba(100,150,255,0.3); border:1px solid rgba(100,150,255,0.5); border-radius:6px; color:#fff; cursor:pointer; transition:0.2s; white-space:nowrap; flex-shrink:0; }
.btn:hover { background:rgba(100,150,255,0.5); }
.btn-danger { background:rgba(255,100,100,0.3); border-color:rgba(255,100,100,0.5); }
.btn-danger:hover { background:rgba(255,100,100,0.5); }

/* –ì—Ä–∞—Ñ—ñ—á–Ω—ñ –±–ª–æ–∫–∏ –∫—Ä–∞—Ñ—Ç—É */
.chain-container { display:flex; flex-direction:column; align-items:center; gap:20px; margin:30px 0; }
.chain-block { display:flex; flex-wrap:wrap; justify-content:center; gap:12px; padding:16px; border-radius:12px; min-width:220px; color:#fff; font-weight:bold;
    opacity:0; transform:translateY(30px); transition: all 0.5s ease, box-shadow 0.3s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.4); }
.chain-block.show { opacity:1; transform:translateY(0); }
.chain-block:hover { box-shadow: 0 8px 15px rgba(0,0,0,0.6); transform:translateY(-2px); transition: all 0.3s ease; }
.chain-ore { background:linear-gradient(145deg,#6b4226,#8b5e3c);}      /* –±–∞–∑–æ–≤—ñ —Ä–µ—Å—É—Ä—Å–∏ */
.chain-ingot { background:linear-gradient(145deg,#888888,#aaaaaa);}    /* –∑–ª–∏—Ç–∫–∏ */
.chain-part { background:linear-gradient(145deg,#4444ff,#6677ff);}     /* –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ */
.chain-finish { background:linear-gradient(145deg,#ff4444,#ff7777);}   /* –≥–æ—Ç–æ–≤–∏–π –ø—Ä–µ–¥–º–µ—Ç */
.chain-item { display:flex; flex-direction:column; align-items:center; padding:8px 12px; border-radius:8px; text-align:center; min-width:110px; }
.chain-arrow { font-size:28px; opacity:0; transform:translateY(20px); transition: all 0.5s ease; }
.chain-arrow.show { opacity:1; transform:translateY(0); }

/* –ê–¥–∞–ø—Ç–∏–≤ */
@media (max-width:800px){
  .container { flex-direction:column; }
  .menu { width:100%; display:flex; flex-direction:row; overflow:auto; }
  .menu div { flex:0 0 auto; }
}
</style>
</head>
<body>

<div class="header">Castello Guns</div>

<div class="container">
  <div class="menu" id="menu">
    <div data-category="revolvers">–†–µ–≤–æ–ª—å–≤–µ—Ä–∏</div>
    <div data-category="rifles">–ì–≤–∏–Ω—Ç—ñ–≤–∫–∏</div>
    <div data-category="repeaters">–†—ñ–ø—ñ—Ç–µ—Ä–∏</div>
    <div data-category="shotguns">–î—Ä–æ–±–æ–≤–∏–∫–∏</div>
    <div data-category="ingots">–ó–ª–∏—Ç–∫–∏ —Ç–∞ –ø–ª–∞–≤–∫–∞</div>
    <div data-category="parts">–ó–∞–ø—á–∞—Å—Ç–∏–Ω–∏</div>
  </div>

  <div class="content">
    <div class="controls">
      <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å: <input type="number" id="qty" value="1" min="1"></label>
      <label id="goldSelector" style="display:none;">–ó–æ–ª–æ—Ç–æ:
        <select id="goldOption">
          <option value="0">–ó–æ–ª–æ—Ç–∞ —Ä—É–¥–∞ (10)</option>
          <option value="1">–°–µ—Ä–µ–¥–Ω—ñ–π —Å–∞–º–æ—Ä–æ–¥–æ–∫ (20)</option>
          <option value="2">–ú–∞–ª–∏–π —Å–∞–º–æ—Ä–æ–¥–æ–∫ (30)</option>
        </select>
      </label>
    </div>

    <div class="items" id="items"></div>

    <div class="tabs-container" id="tabsContainer" style="display:none;">
      <button class="tab-btn active" data-tab="all">–£—Å–µ</button>
      <button class="tab-btn" data-tab="needed">–ü–æ—Ç—Ä—ñ–±–Ω–æ</button>
    </div>

    <input type="text" class="search-box" id="searchBox" placeholder="üîç –ü–æ—à—É–∫ —Ä–µ—Å—É—Ä—Å—ñ–≤..." style="display:none;">

    <div class="chain-container" id="craftChain"></div>
    <div class="block" id="totals">–ó–∞–≥–∞–ª—å–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏: –≤–∏–±–µ—Ä—ñ—Ç—å –ø—Ä–µ–¥–º–µ—Ç</div>
    
    <div class="button-group">
      <button class="btn" id="clearCollectedBtn">–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –≥–∞–ª–æ—á–∫–∏</button>
      <button class="btn btn-danger" id="clearAllBtn">–°–∫–∏–Ω—É—Ç–∏ —É—Å–µ</button>
    </div>
    <div class="block" id="resourcesList"></div>
  </div>
</div>

<script>
// –î–∞–Ω—ñ
const data = {
  rifles: {
    "–ì–≤–∏–Ω—Ç—ñ–≤–∫–∞ Boltaction": { "–ö–æ—Ä–ø—É—Å –≤–∞–∂–∫–æ—ó –∑–±—Ä–æ—ó":1, "–î—É–ª–æ":1, "–î–µ—Ä–µ–≤–æ":25, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":4 },
    "–ì–≤–∏–Ω—Ç—ñ–≤–∫–∞ Springfield": { "–ö–æ—Ä–ø—É—Å –≤–∞–∂–∫–æ—ó –∑–±—Ä–æ—ó":1, "–î—É–ª–æ":1, "–î–µ—Ä–µ–≤–æ":20, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":4 }
  },
  shotguns: {
    "–î—Ä–æ–±–æ–≤–∏–∫ Double Barrel": { "–ö–æ—Ä–ø—É—Å –≤–∞–∂–∫–æ—ó –∑–±—Ä–æ—ó":1, "–î—É–ª–æ":2, "–î–µ—Ä–µ–≤–æ":5, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":3 },
    "–î—Ä–æ–±–æ–≤–∏–∫ Repeating": { "–ö–æ—Ä–ø—É—Å –≤–∞–∂–∫–æ—ó –∑–±—Ä–æ—ó":1, "–î—É–ª–æ":1, "–î–µ—Ä–µ–≤–æ":5, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":2 },
    "–î—Ä–æ–±–æ–≤–∏–∫ Semi-Auto": { "–ö–æ—Ä–ø—É—Å –≤–∞–∂–∫–æ—ó –∑–±—Ä–æ—ó":1, "–î—É–ª–æ":1, "–î–µ—Ä–µ–≤–æ":5, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":2 }
  },
  revolvers: {
    "Cattleman": { "–ö–æ—Ä–ø—É—Å –ª–µ–≥–∫–æ—ó –∑–±—Ä–æ—ó":1, "–î—É–ª–æ":1, "–ë–∞—Ä–∞–±–∞–Ω":1, "–î–µ—Ä–µ–≤–æ":1, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":2 },
    "Double Action": { "–ö–æ—Ä–ø—É—Å –ª–µ–≥–∫–æ—ó –∑–±—Ä–æ—ó":1, "–î—É–ª–æ":1, "–ë–∞—Ä–∞–±–∞–Ω":1, "–î–µ—Ä–µ–≤–æ":1, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":2 },
    "Double Action Gambler": { "–ö–æ—Ä–ø—É—Å –ª–µ–≥–∫–æ—ó –∑–±—Ä–æ—ó":1, "–î—É–ª–æ":1, "–ë–∞—Ä–∞–±–∞–Ω":1, "–î–µ—Ä–µ–≤–æ":1, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":2 },
    "Lemat": { "–ö–æ—Ä–ø—É—Å –ª–µ–≥–∫–æ—ó –∑–±—Ä–æ—ó":1, "–î—É–ª–æ":2, "–ë–∞—Ä–∞–±–∞–Ω":1, "–î–µ—Ä–µ–≤–æ":1, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":2 },
    "Navy": { "–ö–æ—Ä–ø—É—Å –ª–µ–≥–∫–æ—ó –∑–±—Ä–æ—ó":1, "–î—É–ª–æ":1, "–ë–∞—Ä–∞–±–∞–Ω":1, "–î–µ—Ä–µ–≤–æ":1, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":3, "–ó–ª–∏—Ç–æ–∫ –∑–æ–ª–æ—Ç–∞":1, "–ó–ª–∏—Ç–æ–∫ —Å—Ä—ñ–±–ª–∞":1 },
    "Schofield": { "–ö–æ—Ä–ø—É—Å –ª–µ–≥–∫–æ—ó –∑–±—Ä–æ—ó":1, "–î—É–ª–æ":1, "–ë–∞—Ä–∞–±–∞–Ω":1, "–î–µ—Ä–µ–≤–æ":1, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":2 }
  },
  repeaters: {
    "Carbine": { "–ö–æ—Ä–ø—É—Å –≤–∞–∂–∫–æ—ó –∑–±—Ä–æ—ó":1, "–î—É–ª–æ":1, "–î–µ—Ä–µ–≤–æ":5, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":3 },
    "Evans": { "–ö–æ—Ä–ø—É—Å –≤–∞–∂–∫–æ—ó –∑–±—Ä–æ—ó":1, "–î—É–ª–æ":1, "–î–µ—Ä–µ–≤–æ":10, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":3 },
    "Lancaster": { "–ö–æ—Ä–ø—É—Å –≤–∞–∂–∫–æ—ó –∑–±—Ä–æ—ó":1, "–î—É–ª–æ":2, "–î–µ—Ä–µ–≤–æ":5, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":3 },
    "Litchfield": { "–ö–æ—Ä–ø—É—Å –≤–∞–∂–∫–æ—ó –∑–±—Ä–æ—ó":1, "–î—É–ª–æ":2, "–î–µ—Ä–µ–≤–æ":5, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":3 }
  },
  parts: {
    "–ö–æ—Ä–ø—É—Å –≤–∞–∂–∫–æ—ó –∑–±—Ä–æ—ó": { "–ó–ª–∏—Ç–æ–∫ –∑–∞–ª—ñ–∑–∞":2, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":2, "–î–µ—Ä–µ–≤–æ":10 },
    "–ö–æ—Ä–ø—É—Å –ª–µ–≥–∫–æ—ó –∑–±—Ä–æ—ó": { "–ó–ª–∏—Ç–æ–∫ –∑–∞–ª—ñ–∑–∞":1, "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":1, "–î–µ—Ä–µ–≤–æ":5 },
    "–ë–∞—Ä–∞–±–∞–Ω": { "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":1 },
    "–î—É–ª–æ": { "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ":1 },
    "–ì–ª–∏–Ω—è–Ω–∞ —Ñ–æ—Ä–º–∞": { "–ì–ª–∏–Ω–∞":5, "–í—É–≥—ñ–ª–ª—è":5 }
  },
  ingots: {
    "–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ": { "–ó–ª–∏—Ç–æ–∫ –∑–∞–ª—ñ–∑–∞":1, "–í—É–≥—ñ–ª–ª—è":5, "–ì–ª–∏–Ω—è–Ω–∞ —Ñ–æ—Ä–º–∞":1 },
    "–ó–ª–∏—Ç–æ–∫ –∑–∞–ª—ñ–∑–∞": { "–ó–∞–ª—ñ–∑–Ω–∞ —Ä—É–¥–∞":10, "–í—É–≥—ñ–ª–ª—è":5, "–ì–ª–∏–Ω—è–Ω–∞ —Ñ–æ—Ä–º–∞":1 },
    "–ó–ª–∏—Ç–æ–∫ –∑–æ–ª–æ—Ç–∞": [
      { "–ó–æ–ª–æ—Ç–∞ —Ä—É–¥–∞":10, "–í—É–≥—ñ–ª–ª—è":5, "–ì–ª–∏–Ω—è–Ω–∞ —Ñ–æ—Ä–º–∞":1 },
      { "–°–µ—Ä–µ–¥–Ω—ñ–π —Å–∞–º–æ—Ä–æ–¥–æ–∫":20, "–í—É–≥—ñ–ª–ª—è":5, "–ì–ª–∏–Ω—è–Ω–∞ —Ñ–æ—Ä–º–∞":1 },
      { "–ú–∞–ª–∏–π —Å–∞–º–æ—Ä–æ–¥–æ–∫":30, "–í—É–≥—ñ–ª–ª—è":5, "–ì–ª–∏–Ω—è–Ω–∞ —Ñ–æ—Ä–º–∞":1 }
    ],
    "–ó–ª–∏—Ç–æ–∫ —Å—Ä—ñ–±–ª–∞": { "–°—Ä—ñ–±–Ω–∞ —Ä—É–¥–∞":10, "–í—É–≥—ñ–ª–ª—è":5, "–ì–ª–∏–Ω—è–Ω–∞ —Ñ–æ—Ä–º–∞":1 },
    "–ó–ª–∏—Ç–æ–∫ –º—ñ–¥—ñ": { "–ú—ñ–¥–Ω–∞ —Ä—É–¥–∞":10, "–í—É–≥—ñ–ª–ª—è":5, "–ì–ª–∏–Ω—è–Ω–∞ —Ñ–æ—Ä–º–∞":1 },
    "–ó–ª–∏—Ç–æ–∫ —Å–≤–∏–Ω—Ü—é": { "–°–≤–∏–Ω—Ü–µ–≤–∞ —Ä—É–¥–∞":10, "–í—É–≥—ñ–ª–ª—è":5, "–ì–ª–∏–Ω—è–Ω–∞ —Ñ–æ—Ä–º–∞":1 },
    "–ó–ª–∏—Ç–æ–∫ –ª–∞—Ç—É–Ω—ñ": { "–ó–ª–∏—Ç–æ–∫ –º—ñ–¥—ñ":1, "–ó–ª–∏—Ç–æ–∫ —Ü–∏–Ω–∫—É":1, "–í—É–≥—ñ–ª–ª—è":5, "–ì–ª–∏–Ω—è–Ω–∞ —Ñ–æ—Ä–º–∞":1 },
    "–ó–ª–∏—Ç–æ–∫ —Ü–∏–Ω–∫—É": { "–¶–∏–Ω–∫–æ–≤–∞ —Ä—É–¥–∞":10, "–í—É–≥—ñ–ª–ª—è":5, "–ì–ª–∏–Ω—è–Ω–∞ —Ñ–æ—Ä–º–∞":1 }
  }
};

// DOM
const menu = document.getElementById('menu');
const items = document.getElementById('items');
const craftChain = document.getElementById('craftChain');
const totals = document.getElementById('totals');
const qtyInput = document.getElementById('qty');
const goldSelector = document.getElementById('goldSelector');
const goldOption = document.getElementById('goldOption');
const resourcesList = document.getElementById('resourcesList');
const clearCollectedBtn = document.getElementById('clearCollectedBtn');
const clearAllBtn = document.getElementById('clearAllBtn');

let currentCategory = '';
let currentItem = '';
let collected = {};
let favorites = {};
let currentTab = 'all';
let searchQuery = '';

const isPart = name => Object.prototype.hasOwnProperty.call(data.parts, name);
const isIngot = name => Object.prototype.hasOwnProperty.call(data.ingots, name);

// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑—ñ–±—Ä–∞–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤
function loadCollected() {
  try {
    const saved = localStorage.getItem('collectedResources');
    collected = saved ? JSON.parse(saved) : {};
  } catch (e) {
    collected = {};
  }
}

function loadFavorites() {
  try {
    const saved = localStorage.getItem('favoriteWeapons');
    favorites = saved ? JSON.parse(saved) : {};
  } catch (e) {
    favorites = {};
  }
}

function saveFavorites() {
  localStorage.setItem('favoriteWeapons', JSON.stringify(favorites));
}

function saveCollected() {
  localStorage.setItem('collectedResources', JSON.stringify(collected));
}

function toggleCollected(resourceName, amount) {
  if (!collected[resourceName]) {
    collected[resourceName] = amount;
  } else {
    delete collected[resourceName];
  }
  saveCollected();
  if (currentItem) showGraphicalSummary();
}

function getRecipe(name) {
  if (isPart(name)) return data.parts[name];
  if (isIngot(name)) {
    const r = data.ingots[name];
    if (Array.isArray(r)) {
      const idx = parseInt(goldOption.value) || 0;
      return r[idx] || r[0];
    }
    return r;
  }
  return null;
}

/**
 * expand(name, count, base, ingots, components)
 * –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞—î —Ä–µ—Ü–µ–ø—Ç:
 * - —è–∫—â–æ name —î —á–∞—Å—Ç–∏–Ω–æ—é (parts) -> –¥–æ–¥–∞—î —É components —ñ —Ä–æ–∑–≥–æ—Ä—Ç–∞—î –π–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç
 * - —è–∫—â–æ name —î –∑–ª–∏—Ç–∫–æ–º (ingots) -> –¥–æ–¥–∞—î —É ingots —ñ —Ä–æ–∑–≥–æ—Ä—Ç–∞—î –π–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç
 * - —ñ–Ω–∞–∫—à–µ -> –≤–≤–∞–∂–∞—î–º–æ –±–∞–∑–æ–≤–∏–º —Ä–µ—Å—É—Ä—Å–æ–º —ñ –¥–æ–¥–∞—î–º–æ —É base
 */
function expand(name, count, base={}, ingots={}, components={}) {
  const recipe = getRecipe(name);
  if (isPart(name)) {
    components[name] = (components[name] || 0) + count;
    if (recipe) for (const k in recipe) expand(k, recipe[k]*count, base, ingots, components);
  } else if (isIngot(name)) {
    ingots[name] = (ingots[name] || 0) + count;
    if (recipe) for (const k in recipe) expand(k, recipe[k]*count, base, ingots, components);
  } else {
    base[name] = (base[name] || 0) + count;
  }
  return { base, ingots, components };
}

function renderItems() {
  items.innerHTML='';
  const catData = data[currentCategory] || {};
  const keys = Object.keys(catData);
  if (!keys.length) {
    const d = document.createElement('div');
    d.className='item';
    d.textContent='–ù–µ–º–∞—î –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —É —Ü—ñ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó';
    d.style.opacity='0.8';
    items.appendChild(d);
    return;
  }
  keys.forEach(itemName=>{
    const d = document.createElement('div');
    d.className='item favorites-badge';
    if (favorites[itemName]) d.classList.add('favorited');
    
    const textSpan = document.createElement('span');
    textSpan.textContent=itemName;
    textSpan.style.flex='1';
    d.appendChild(textSpan);
    
    const favBtn = document.createElement('button');
    favBtn.className='btn';
    favBtn.style.padding='4px 8px';
    favBtn.textContent = favorites[itemName] ? '‚òÖ' : '‚òÜ';
    favBtn.style.minWidth='30px';
    favBtn.addEventListener('click', (e)=>{
      e.stopPropagation();
      favorites[itemName] = !favorites[itemName];
      saveFavorites();
      renderItems();
    });
    
    d.appendChild(favBtn);
    
    d.addEventListener('click', ()=>{
      currentItem=itemName;
      items.querySelectorAll('.item').forEach(el=>el.classList.remove('active-item'));
      d.classList.add('active-item');
      showGraphicalSummary();
    });
    items.appendChild(d);
  });
}

menu.querySelectorAll('div').forEach(node=>{
  node.addEventListener('click', ()=>{
    const cat=node.dataset.category;
    if (!cat || !data[cat]) return;
    currentCategory=cat;
    menu.querySelectorAll('div').forEach(el=>el.classList.remove('active'));
    node.classList.add('active');
    renderItems();
    craftChain.innerHTML = '';
    totals.innerHTML='–ó–∞–≥–∞–ª—å–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏: –≤–∏–±–µ—Ä—ñ—Ç—å –ø—Ä–µ–¥–º–µ—Ç';
    goldSelector.style.display='none';
    // –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–±—Ä–∞—Ç–∏ –ø–µ—Ä—à–∏–π –µ–ª–µ–º–µ–Ω—Ç —É –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (—è–∫—â–æ —î)
    const firstItem = items.querySelector('.item');
    if(firstItem){
      firstItem.click();
    }
  });
});

function showGraphicalSummary() {
  if (!currentCategory || !currentItem) {
    craftChain.innerHTML = '';
    totals.innerHTML = '–ó–∞–≥–∞–ª—å–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏: –≤–∏–±–µ—Ä—ñ—Ç—å –ø—Ä–µ–¥–º–µ—Ç';
    return;
  }

  const qty = parseInt(qtyInput.value) || 1;
  const recipe = data[currentCategory][currentItem];
  let base = {}, ingots = {}, components = {};
  for (const k in recipe) {
    const result = expand(k, recipe[k] * qty, base, ingots, components);
    base = result.base;
    ingots = result.ingots;
    components = result.components;
  }

  const usesGold = !!ingots["–ó–ª–∏—Ç–æ–∫ –∑–æ–ª–æ—Ç–∞"] || currentItem==="–ó–ª–∏—Ç–æ–∫ –∑–æ–ª–æ—Ç–∞";
  goldSelector.style.display = usesGold ? 'inline-flex' : 'none';

  const icons = {
    '–î–µ—Ä–µ–≤–æ':'ü™µ','–ó–∞–ª—ñ–∑–Ω–∞ —Ä—É–¥–∞':'‚õèÔ∏è','–°—Ä—ñ–±–Ω–∞ —Ä—É–¥–∞':'‚õèÔ∏è','–ó–æ–ª–æ—Ç–∞ —Ä—É–¥–∞':'‚õèÔ∏è','–ú—ñ–¥–Ω–∞ —Ä—É–¥–∞':'‚õèÔ∏è',
    '–°–≤–∏–Ω—Ü–µ–≤–∞ —Ä—É–¥–∞':'‚õèÔ∏è','–¶–∏–Ω–∫–æ–≤–∞ —Ä—É–¥–∞':'‚õèÔ∏è','–í—É–≥—ñ–ª–ª—è':'üî•','–ì–ª–∏–Ω–∞':'üü§',
    '–ó–ª–∏—Ç–æ–∫ –∑–∞–ª—ñ–∑–∞':'‚öíÔ∏è','–ó–ª–∏—Ç–æ–∫ —Å—Ç–∞–ª—ñ':'‚öíÔ∏è','–ó–ª–∏—Ç–æ–∫ –∑–æ–ª–æ—Ç–∞':'‚öíÔ∏è','–ó–ª–∏—Ç–æ–∫ —Å—Ä—ñ–±–ª–∞':'‚öíÔ∏è',
    '–ó–ª–∏—Ç–æ–∫ –º—ñ–¥—ñ':'‚öíÔ∏è','–ó–ª–∏—Ç–æ–∫ —Å–≤–∏–Ω—Ü—é':'‚öíÔ∏è','–ó–ª–∏—Ç–æ–∫ –ª–∞—Ç—É–Ω—ñ':'‚öíÔ∏è','–ó–ª–∏—Ç–æ–∫ —Ü–∏–Ω–∫—É':'‚öíÔ∏è',
    '–ö–æ—Ä–ø—É—Å –≤–∞–∂–∫–æ—ó –∑–±—Ä–æ—ó':'üî©','–ö–æ—Ä–ø—É—Å –ª–µ–≥–∫–æ—ó –∑–±—Ä–æ—ó':'üî©','–ë–∞—Ä–∞–±–∞–Ω':'üî©','–î—É–ª–æ':'üî©','–ì–ª–∏–Ω—è–Ω–∞ —Ñ–æ—Ä–º–∞':'üü§'
  };

  function makeBlock(items, className) {
    const block = document.createElement('div');
    block.className = 'chain-block ' + className;
    // —è–∫—â–æ –Ω–µ–º–∞—î –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ (—Ä—ñ–¥–∫—ñ—Å–Ω–∞ —Å–∏—Ç—É–∞—Ü—ñ—è), –ø–æ–∫–∞–∑–∞—Ç–∏ "–ù–µ–º–∞—î"
    const keys = Object.keys(items);
    if (!keys.length) {
      const empty = document.createElement('div');
      empty.className = 'chain-item';
      empty.textContent = '‚Äî –ù–µ–º–∞—î ‚Äî';
      block.appendChild(empty);
      return block;
    }
    keys.forEach(k=>{
      const itemDiv = document.createElement('div');
      itemDiv.className = 'chain-item';
      itemDiv.textContent = `${icons[k] || ''} ${k}: ${items[k]}`;
      block.appendChild(itemDiv);
    });
    return block;
  }

  function createArrow() {
    const arrow = document.createElement('div');
    arrow.className = 'chain-arrow';
    arrow.textContent = '‚¨áÔ∏è';
    return arrow;
  }

  // –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∞ –¥–æ–¥–∞—î–º–æ –±–ª–æ–∫–∏
  craftChain.innerHTML = '';
  const blocks = [];
  if (Object.keys(base).length) { blocks.push(makeBlock(base,'chain-ore')); blocks.push(createArrow()); }
  if (Object.keys(ingots).length) { blocks.push(makeBlock(ingots,'chain-ingot')); blocks.push(createArrow()); }
  if (Object.keys(components).length) { blocks.push(makeBlock(components,'chain-part')); blocks.push(createArrow()); }

  const finish = document.createElement('div');
  finish.className = 'chain-block chain-finish';
  const finishDiv = document.createElement('div');
  finishDiv.className = 'chain-item';
  finishDiv.textContent = `${currentItem} √ó ${qty}`;
  finish.appendChild(finishDiv);
  blocks.push(finish);

  blocks.forEach((b,i)=>{
    craftChain.appendChild(b);
    // –∞–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏ –ø–æ —á–µ—Ä–∑—ñ
    setTimeout(()=>{ b.classList.add('show'); 
      // —è–∫—â–æ —Ü–µ —Å—Ç—Ä—ñ–ª–∫–∞ ‚Äî –¥–æ–¥–∞—Ç–∏ –æ–∫—Ä–µ–º–∏–π –∫–ª–∞—Å show –¥–ª—è –Ω–µ—ó (—â–æ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–æ–π –∂–µ —Å—Ç–∏–ª—å)
      if(b.classList.contains('chain-arrow')) b.classList.add('show');
    }, i * 350);
  });

  // –ü—ñ–¥—Å—É–º–æ–∫ –∑–∞–≥–∞–ª—å–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤ (—Å–∫–ª–∞–¥–∞—î–º–æ –±–∞–∑–æ–≤—ñ, –∑–ª–∏—Ç–∫–∏, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏)
  let total = {};
  [base, ingots, components].forEach(obj=>{
    for (let k in obj) total[k] = (total[k] || 0) + obj[k];
  });
  const totalKeys = Object.keys(total);
  
  // –ü–æ–∫–∞–∑ –≤–∫–ª–∞–¥–æ–∫ —Ç–∞ –ø–æ—à—É–∫—É
  document.getElementById('tabsContainer').style.display = totalKeys.length > 0 ? 'flex' : 'none';
  document.getElementById('searchBox').style.display = totalKeys.length > 0 ? 'block' : 'none';
  
  if (!totalKeys.length) {
    totals.innerHTML = `<b>–ó–∞–≥–∞–ª—å–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏ –¥–ª—è ${qty} —à—Ç:</b><br>‚Ä¢ –ù–µ–º–∞—î`;
    resourcesList.innerHTML = '';
    document.getElementById('tabsContainer').style.display = 'none';
    document.getElementById('searchBox').style.display = 'none';
  } else {
    // –û–±—á–∏—Å–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É
    let collectedCount = 0;
    totalKeys.forEach(k => {
      if (collected[k]) collectedCount++;
    });
    const progress = Math.round((collectedCount / totalKeys.length) * 100);
    
    totals.innerHTML = `<b>–ó–∞–≥–∞–ª—å–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏ –¥–ª—è ${qty} —à—Ç:</b><br>` + totalKeys.map(k=>`${icons[k]||''} ${k}: ${total[k]}`).join('<br>');
    totals.innerHTML += `
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" style="width:${progress}%">
            ${progress > 5 ? progress + '%' : ''}
          </div>
        </div>
        <div class="progress-text">${collectedCount}/${totalKeys.length} —Ä–µ—Å—É—Ä—Å—ñ–≤ –∑—ñ–±—Ä–∞–Ω–æ</div>
      </div>
    `;
    
    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ –∑ –≥–∞–ª–æ—á–∫–∞–º–∏ —Ç–∞ —Å—Ç–∞—Ç—É—Å–æ–º
    resourcesList.innerHTML = '<b style="margin-bottom:8px; display:block;">–ó—ñ–±—Ä–∞–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏:</b>';
    
    let filteredKeys = totalKeys;
    if (currentTab === 'needed') {
      filteredKeys = totalKeys.filter(k => !collected[k]);
    }
    if (searchQuery) {
      filteredKeys = filteredKeys.filter(k => k.toLowerCase().includes(searchQuery.toLowerCase()));
    }
    
    filteredKeys.forEach(k=>{
      const needed = total[k];
      const haveCount = collected[k] || 0;
      const isCollected = !!collected[k];
      const remaining = Math.max(0, needed - haveCount);
      
      // –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
      let resourceType = 'base-resource';
      if (isPart(k)) resourceType = 'component-resource';
      else if (isIngot(k)) resourceType = 'ingot-resource';
      
      const itemDiv = document.createElement('div');
      itemDiv.className = 'resource-item ' + resourceType + (isCollected ? ' collected' : '');
      
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = isCollected;
      checkbox.addEventListener('change', ()=>{
        toggleCollected(k, needed);
      });
      
      const label = document.createElement('label');
      label.innerHTML = `${icons[k]||''} <span>${k}</span>`;
      
      // –°—Ç–∞—Ç—É—Å –±–∞—Ç–æ–Ω
      const statusDiv = document.createElement('div');
      statusDiv.className = 'resource-status';
      if (isCollected) {
        statusDiv.className += ' status-complete';
        statusDiv.innerHTML = '‚úì';
      } else if (needed > 0) {
        statusDiv.className += ' status-empty';
        statusDiv.innerHTML = '‚óã';
      }
      
      const countSpan = document.createElement('div');
      countSpan.className = 'resource-count';
      countSpan.textContent = isCollected ? `‚úì ${haveCount}/${needed}` : `0/${needed}`;
      
      itemDiv.appendChild(checkbox);
      itemDiv.appendChild(label);
      itemDiv.appendChild(statusDiv);
      itemDiv.appendChild(countSpan);
      resourcesList.appendChild(itemDiv);
    });
    
    if (filteredKeys.length === 0 && (currentTab === 'needed' || searchQuery)) {
      const emptyMsg = document.createElement('div');
      emptyMsg.style.padding = '12px';
      emptyMsg.style.textAlign = 'center';
      emptyMsg.style.opacity = '0.7';
      emptyMsg.textContent = currentTab === 'needed' ? '–£—Å—ñ —Ä–µ—Å—É—Ä—Å–∏ –∑—ñ–±—Ä–∞–Ω—ñ! üéâ' : '–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
      resourcesList.appendChild(emptyMsg);
    }
  }
}

// –ü–æ–¥—ñ—ó –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∞–±–æ –æ–ø—Ü—ñ–π –∑–æ–ª–æ—Ç–∞
qtyInput.addEventListener('input', ()=>{ if(currentItem) showGraphicalSummary(); });
goldOption.addEventListener('change', ()=>{ if(currentItem) showGraphicalSummary(); });

// –û–±—Ä–æ–±–∫–∞ –≤–∫–ª–∞–¥–æ–∫
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    currentTab = btn.dataset.tab;
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    if (currentItem) showGraphicalSummary();
  });
});

// –ü–æ—à—É–∫
document.getElementById('searchBox').addEventListener('input', (e) => {
  searchQuery = e.target.value;
  if (currentItem) showGraphicalSummary();
});

// –û–±—Ä–æ–±–∫–∞ –∫–Ω–æ–ø–æ–∫
clearCollectedBtn.addEventListener('click', ()=>{
  collected = {};
  saveCollected();
  if(currentItem) showGraphicalSummary();
});

clearAllBtn.addEventListener('click', ()=>{
  if(confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ? –¶–µ —Å–∫–∏–Ω–µ –≤—Å—ñ –≥–∞–ª–æ—á–∫–∏.')) {
    collected = {};
    saveCollected();
    if(currentItem) showGraphicalSummary();
  }
});

// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –Ω–∞ —Å—Ç–∞—Ä—Ç—ñ
loadCollected();
loadFavorites();

// –ü–æ—á–∞—Ç–∫–æ–≤–∏–π –∫–ª—ñ–∫ –ø–æ –ø–µ—Ä—à—ñ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (—â–æ–± –æ–¥—Ä–∞–∑—É –ø–æ–∫–∞–∑–∞—Ç–∏ —Å–ø–∏—Å–æ–∫)
const first = menu.querySelector('div[data-category]');
if (first) first.click();
</script>
</body>
</html>






